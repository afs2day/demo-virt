= Migrating Virtual Machines from VMware to OpenShift using MTV

https://red.ht/mtv-docs[Migration Toolkit for Virtualization]

== Steps

=== Install Migration Toolkit for Virtualization Operator

* Install and configure MTV Operator


[source,bash]
----
oc apply -k operator/overlays/release-v2.3
oc apply -k instance/base
oc get pods -n openshift-mtv
URL="https://$(oc get route virt -n openshift-mtv -o jsonpath='{.spec.host}')"
----

Visit $URL for the Migration Toolkit for Virtualization console.

=== Build Container Image

* Build a container image using the https://developer.vmware.com/web/sdk/7.0/vddk[VMware VDDK]

==== Expose OpenShift Cluster Registry

You may optionally https://docs.openshift.com/container-platform/latest/registry/securing-exposing-registry.html[expose the OpenShift cluster image registry] to store the VDDK image built in the following step.

[source,bash]
----
oc patch configs.imageregistry.operator.openshift.io/cluster --patch '{"spec":{"defaultRoute":true}}' --type=merge

REGISTRY=$(oc get route default-route -n openshift-image-registry --template='{{ .spec.host }}')
----

* Build and push vddk image to OpenShift registry. In imagstream in openshift-mtv named vddk will be created.

[source,bash]
----
make push
----

=== Create a Provider

* https://access.redhat.com/documentation/en-us/migration_toolkit_for_virtualization/2.3/html/installing_and_using_the_migration_toolkit_for_virtualization/migrating-vms-web-console#adding-source-provider_vmware[Create a VMware provider]

image:img/provider.png[]

* Select a Migration Network for a host in the vSphere cluster.

.**Blocker**
[WARNING]
Right now this does not work in my lab.

image:img/migration-network.png[]